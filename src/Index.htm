<!DOCTYPE html>
<html>
<head>
    <title>jquery-watch Sample</title>
    <script src="scripts/jquery-1.11.1.min.js" type="text/javascript"></script>

    <!-- just for the samples -->
    <script src="scripts/ww.jquery.min.js" type="text/javascript"></script>
    <script src="scripts/jquery-watch.js"></script>

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css" />
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet" />
    <style>
        .notebox,.shadow {            
            top: 230px;
            left: 200px;
            width: 300px;
            height: 250px;
            position: absolute;
            z-index: 20;
            padding: 25px;
            border-radius: 4px;
            text-align: center;
            background-color: lightsteelblue;
        }
        .shadow {
            left: 545px;
            top: 233px;
            background-color: silver;
            z-index: 19;
            position: absolute;            
        }
        .class_true {
             background: steelblue !important;
             color: white;
         }

        .class_false {
            background: burlywood !important;
            color: black;
        }
        .descriptionheader {
            padding: 20px;
            background: lightsteelblue;
        }
    </style>

</head>
<body>
    <form id="form1">
        <nav class="navbar navbar-default" role="navigation" style="margin-bottom: 0">
            <div class="container-fluid">
                <!-- Brand and toggle get grouped for better mobile display -->
                <div class="navbar-header">
                    <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                    <a class="navbar-brand" href="#" style="font-size: 1.5em"><i class="fa fa-eye"></i> jquery-watch</a>
                </div>

                <!-- Collect the nav links, forms, and other content for toggling -->
                <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1" style="margin-left: 180px;">
                    <ul class="nav navbar-nav">
                        <li class="active"><a href="http://github.com/rickstrahl/jquery-watch"><i class="fa fa-github"></i> GitHub</a></li>
                        <li><a id="lnkRedisplayWindow" href="javascript:{}"><i class="fa fa-close"></i> Show/Hide Window</a></li>
                        <li><a href=""><i class="fa fa-refresh"></i> Refresh Page</a></li>
                    </ul>
                </div>
            </div>
        </nav>
        <aside class="descriptionheader">
            This page demonstrates the watcher plug-in that can be used to observe any Css property
            change and cause a notification in response. In this example a drag operation is performed
            on the blue box and the black box that simulates a shadow is dragged along based on the
            notification of various Css properties includes top, left, height and width, visible etc.
            Notice how the shadow stays 'attached' to the blue box which is all handled via the
            event handler fired on change of each property.
        </aside>

        <div id="AlertBox" class="alert alert-warning" style="display:none;margin-top:none; border-radius:0">
            <i class="fa fa-info"></i>&nbsp;&nbsp;
            <b>Watch Events Fired:</b>
            <span id="msg"></span>
        </div>

        <div class="container">

            <div class="container">
                <div id="notebox" class="notebox">
                    <p>
                        This is the master window. Go ahead drag me around and close me!
                    </p>
                    <p>
                        The shadow window should follow me around and close/fade when I do.
                    </p>
                    <p>
                        There's also a timer, that fires and alternates a CSS class every
                        3 seconds.
                    </p>
                </div>

                <div id="shadow" class="shadow">
                    <p>I'm the Shadow Window!</p>
                    <p>I'm shadowing the Master Window.</p>
                    <p>I'm a copy cat</p>
                    <p>I do as I'm told.</p>
                </div>
            </div>


        </div>
        <script type="text/javascript">
            $(document).ready(function () {
                var counter = 0;
                $("#shadow").show();
                var el = $("#notebox");
                el.draggable();

                // Update a CSS Class on a timer
                var state = false;
                setInterval(function () {
                    //$("#notebox").css("Drag me around " + new Date());
                    $("#notebox")
                        .removeClass("class_true")
                        .removeClass("class_false")
                        .addClass("class_" + state);
                    state = !state;
                }, 3000);


                el.watch("top,left,opacity,attr_class", function (data, i) {
                    // you can capture which attribute has changed
                    var propChanged = data.props[i];
                    var valChanged = data.vals[i];
                    counter++;
                    showStatus(" Changed Property: " + propChanged + "  -  New Value: " + valChanged + " - Event Count:" + counter);

                    // element affected is 'this'
                    var el = $(this);
                    var sh = $("#shadow");

                    // get master current position
                    var pos = el.position();
                    var w = el.outerWidth();
                    var h = el.outerHeight();

                    // and update shadow accordingly
                    sh.css({
                        width: w,
                        height: h,
                        left: pos.left + w + 4,
                        top: pos.top,
                        display: el.css("display"),
                        opacity: el.css("opacity")
                    });

                    // Class attribute is more tricky since there are
                    // multiple classes on the parent - we have to explicitly
                    // check for class existance and assign
                    sh.removeClass("class_true")
                      .removeClass("class_false");
                    if(el.hasClass("class_true"))
                        sh.addClass("class_true");

                });

                function showStatus(msg) {
                    if (!msg) {
                        $("#AlertBox").hide();
                        return;
                    }
                    $("#msg").text(msg);
                    $("#AlertBox").show();
                }
            });

            $("#lnkRedisplayWindow").click(function () {
                var el$ = $("#notebox");

                if (el$.is(":visible"))
                    el$.fadeOut(1000);
                else
                    el$.fadeIn(1000);
            });
        </script>
    </form>

</body>
</html>
